<!DOCTYPE html>
<html lang="en">
<head>
  <title>Vert.x Docker Images - Vert.x</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="Eclipse Vert.x is a tool-kit for building reactive applications on the JVM." name="description">
  <link href="https://vertx.tk/stylesheets/docs.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/stylesheets/font-awesome.min.css" media="screen" rel="stylesheet">
  <link href="https://vertx.tk/javascripts/styles/rainbow.min.css" media="screen" rel="stylesheet">
  <!-- IE 6-8 support of HTML 5 elements -->
  <!--[if lt IE 9]>
  <script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script>
  <![endif]-->

  <link rel="apple-touch-icon" sizes="57x57" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://vertx.tk/assets/favicons/vertx-favicon-7/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="https://vertx.tk/assets/favicons/vertx-favicon-7/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://vertx.tk/assets/favicons/vertx-favicon-7/manifest.json">
  <link rel="mask-icon" href="https://vertx.tk/assets/favicons/vertx-favicon-7/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#7d3194">
  <meta name="msapplication-TileImage" content="https://vertx.tk/assets/favicons/vertx-favicon-7/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700,400italic" rel="stylesheet" type="text/css">
  <link rel="alternate" type="application/rss+xml" title="RSS"
     href="https://vertx.tk/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-30144458-1', 'auto');
    ga('create', 'UA-71153120-1', 'auto', 'tracker');
    ga('send', 'pageview');
    ga('tracker.send', 'pageview');
  </script>
  <style>
    .page-link-to-github {
      position: relative;
      z-index: 1;
      display: inline-block;
      border: 1px solid #782B90;
      border-radius: 5px;
      color: #782B90;
      font-size: 12px;
      padding: 4px 10px;
      text-decoration: none;
      background-color: #ffffff;
    }
    .page-link-to-github:hover {
      color: #ffffff;
      border-color: #ffffff;
      background-color: #782B90;
    }

    .page-link-to-github .github-icon {
      position: absolute;
      display: inline-block;
      width: 20px;
      height: 20px;
      /*background-position: -50px 0*/
      background: url('https://vertx.tk/assets/github.png') no-repeat 0 0;
    }

    @media (-webkit-min-device-pixel-ratio: 2),(min-resolution:192dpi) {
      .page-link-to-github .github-icon {
        background-image:url('https://vertx.tk/assets/github@2x.png');
        background-size: 150px auto
      }
    }

    .page-link-to-github:hover .github-icon {
      /*background-position: 0 0*/
      background-position: -100px 0
    }
    .text {
      text-decoration: underline
    }
    .page-link-to-github .text {
      padding-left: 27px
    }
    .text {
      padding-right: 8px
    }
    .page-link-to-github {
      float: right;
      top: 4px
    }

  </style>
</head>
<body>

<a href="http://www.reactivemanifesto.org/" id="reactive-manifesto-banner">
  <img style="border: 0; position: fixed; right: 0; top:0; z-index: 9000"
    src="https://d379ifj7s9wntv.cloudfront.net/reactivemanifesto/images/ribbons/we-are-reactive-black-right.png">
</a>

<a id="skippy" class="sr-only sr-only-focusable" href="#content"><div class="container"><span class="skiplink-text">Skip to main content</span></div></a>

<header class="navbar navbar-default navbar-static-top" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#vertx-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="https://vertx.tk/" class="navbar-brand"><img alt="Brand" src="https://vertx.tk/assets/logo-sm.png"></a>
    </div>
    <nav class="collapse navbar-collapse" id="vertx-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="http://start.vertx.io">Starter</a></li>
        <li><a href="https://vertx.tk/download/">下载</a></li>
        <li><a href="https://vertx.tk/docs/">文档</a></li>
        <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
        <li><a href="https://vertx.tk/community/">社区</a></li>
        <li><a href="https://vertx.tk/materials/">资料</a></li>
        <li><a href="https://vertx.tk/blog/">博客</a></li>
      </ul>
    </nav>
  </div>
</header>



  <div class="page-header" id="content">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Vert.x Docker Images</h1>
          
        </div>
      </div>
    </div>
  </div>




<div id="content">
  <div class="container docs-content">
    <div class="row">
      <div class="col-sm-12 col-md-push-9 col-md-3 hidden-xs hidden-sm">
        <div id="sidebar" data-spy="affix">
          <ul class="sectlevel1">
<li><a href="#_简介">简介</a></li>
<li><a href="#_基础镜像">基础镜像</a>
<ul class="sectlevel2">
<li><a href="#_在_docker_容器中部署_javascript_verticle">在 Docker 容器中部署 JavaScript Verticle</a></li>
<li><a href="#_在_docker_容器中部署_groovy_verticle">在 Docker 容器中部署 Groovy Verticle</a></li>
<li><a href="#_在_docker_容器中部署_ruby_verticle">在 Docker 容器中部署 Ruby Verticle</a></li>
<li><a href="#_在_docker_容器中部署_java_verticle">在 Docker 容器中部署 Java Verticle</a></li>
<li><a href="#_配置">配置</a></li>
<li><a href="#_通过_maven_构建镜像">通过 Maven 构建镜像</a></li>
<li><a href="#_构建_fabric_8_平台使用的镜像">构建 Fabric 8 平台使用的镜像</a></li>
</ul>
</li>
<li><a href="#_可执行镜像">可执行镜像</a>
<ul class="sectlevel2">
<li><a href="#_自定义技术栈">自定义技术栈</a></li>
</ul>
</li>
<li><a href="#_部署_fat_jar">部署 fat jar</a></li>
</ul>
        </div>
      </div>
      <div class="col-sm-12 col-md-pull-3 col-md-9">
        <div class="toc hidden-md hidden-lg">
          <h2>Table of Contents</h2>
          <ul class="sectlevel1">
<li><a href="#_简介">简介</a></li>
<li><a href="#_基础镜像">基础镜像</a>
<ul class="sectlevel2">
<li><a href="#_在_docker_容器中部署_javascript_verticle">在 Docker 容器中部署 JavaScript Verticle</a></li>
<li><a href="#_在_docker_容器中部署_groovy_verticle">在 Docker 容器中部署 Groovy Verticle</a></li>
<li><a href="#_在_docker_容器中部署_ruby_verticle">在 Docker 容器中部署 Ruby Verticle</a></li>
<li><a href="#_在_docker_容器中部署_java_verticle">在 Docker 容器中部署 Java Verticle</a></li>
<li><a href="#_配置">配置</a></li>
<li><a href="#_通过_maven_构建镜像">通过 Maven 构建镜像</a></li>
<li><a href="#_构建_fabric_8_平台使用的镜像">构建 Fabric 8 平台使用的镜像</a></li>
</ul>
</li>
<li><a href="#_可执行镜像">可执行镜像</a>
<ul class="sectlevel2">
<li><a href="#_自定义技术栈">自定义技术栈</a></li>
</ul>
</li>
<li><a href="#_部署_fat_jar">部署 fat jar</a></li>
</ul>
        </div>

  <a href="https://github.com/okou19900722/vertx-web-site-translation-chinese/tree/master/vertx-translation-stack/vertx-docker-translation"
     class="page-link-to-github"
     target="_blank"
     title="Edit this page on GitHub">
    <i class="github-icon"></i>
    <span class="text">编辑本页</span>
  </a>

        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Execute Vert.x applications in Docker containers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_简介">简介</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.docker.com/">Docker</a> 是一个可以将应用部署在其中的轻量级、隔离的容器。应用程序并行运行在隔离的 Linux 容器中。如果从未使用过 Docker ，可以根据 <a href="https://docs.docker.com/get-started/">官方教程</a> ，轻松入门</p>
</div>
<div class="paragraph">
<p>Vert.x 提供两个 Docker 镜像给开发人员运行部署程序，分别是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vertx/vertx3</code> 基础镜像，需要进行一些扩展才可以运行程序</p>
</li>
<li>
<p><code>vertx/vertx3-exec</code> 给宿主系统提供 <code>vertx</code> 命令行</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个 Docker 镜像均发布在 <a href="https://hub.docker.com/u/vertx/">Docker Hub</a> 中。</p>
</div>
<div class="paragraph">
<p>本指南将介绍如何使用这 Docker 镜像，以及如何使用 Maven 自动生成 Docker 镜像，生成 Fabric8 元数据并使用 <code>fat jar</code> 。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_基础镜像">基础镜像</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>vertx/vertx3</code> 能让开发人员轻松的在 Docker 容器中运行 Vert.x 应用。为实现该目的，开发人员须通过创建自定义 <code>Dockerfile</code> 的形式，继承 <code>vertx/vertx3</code> 。这样便可以通过容器中的 <code>vertx</code> 命令启动应用程序。</p>
</div>
<div class="sect2">
<h3 id="_在_docker_容器中部署_javascript_verticle">在 Docker 容器中部署 JavaScript Verticle</h3>
<div class="paragraph">
<p>编写一个简单的 JS Verticle ，代码如下：</p>
</div>
<div class="listingblock">
<div class="title">hello-verticle.js</div>
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">vertx.createHttpServer().requestHandler(function (request) {
    request.response().end("Hello world");
}).listen(8080);</code></pre>
</div>
</div>
<div class="paragraph">
<p>在同一目录，创建一个 Dockerfile ，代码如下：</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlight"><code># 继承 vert.x 镜像                       <b class="conum">(1)</b>
FROM vertx/vertx3

# 设置要部署的 verticle 名字    <b class="conum">(2)</b>
ENV VERTICLE_NAME hello-verticle.js

# 设置 verticles 存放路径         <b class="conum">(3)</b>
ENV VERTICLE_HOME /usr/verticles

EXPOSE 8080

# 拷贝 verticle 至容器中       <b class="conum">(4)</b>
COPY $VERTICLE_NAME $VERTICLE_HOME/

# Launch the verticle                       <b class="conum">(5)</b>
WORKDIR $VERTICLE_HOME
ENTRYPOINT ["sh", "-c"]
CMD ["exec vertx run $VERTICLE_NAME -cp $VERTICLE_HOME/*"]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>继承 vert.x 镜像</p>
</li>
<li>
<p>设置要部署的 verticle 名字</p>
</li>
<li>
<p>设置 verticles 存放路径</p>
</li>
<li>
<p>拷贝 verticle 至容器中</p>
</li>
<li>
<p>启动 verticle</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>接下来就可以构建 Docker 镜像了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker build -t sample/vertx-javascript .</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后执行下面脚本便可以启动应用了。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker run -t -i -p 8080:8080 sample/vertx-javascript</code></pre>
</div>
</div>
<div class="paragraph">
<p>这时候可以打开浏览器验证成果了，在浏览器输入地址 <a href="http://localhost:8080" class="bare">http://localhost:8080</a> （如果是 docker 引擎是 boot2docker 的话，则输入 <a href="http://192.168.59.103:8080" class="bare">http://192.168.59.103:8080</a> ）。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
'-t -i' 参数意味着是互动模式。按 <code>CTRL + C</code> 可以停止容器。点击 <a href="http://docs.docker.com/reference/run/">这里</a> 查阅 Docker <code>run</code> 命令详细信息。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>可能已经注意到 <code>Dockerfile</code> 中的 <code>EXPOSE 8080</code> 和运行命令中的 <code>-p 8080:8080</code> 。第一个是可选的信息，告诉应用程序想要监听8080端口。第二个是强制性的，并指示码头工具将8080端口从主机转发到容器的8080端口。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
可能还注意到复杂且令人费解的应用程序的启动方式。不是直接调用 <code>vertx</code>，而是与 <code>exec</code> 一起使用 <code>sh -c</code>。 <code>sh -c</code> 是转向Docker限制，而不是在 <code>CMD</code> 中扩展变量。
关于 <code>Docker</code> 构建器文档的更多细节，查阅 <a href="http://docs.docker.com/reference/builder/#cmd">文档</a> 。
<code>exec</code> 是使 <code>vertx</code> 命令进程替换 <code>shell</code> ，以便获取pid 1并接收信号，比如在运行 <code>docker stop</code> 时，获取 <code>SIGTERM</code> 。
如果没有 <code>exec</code> ，那么 <code>shell `会随着 `vertx</code> 命令进程一直运行，而且 <code>vertx</code> 命令难以得到信号，从而阻止正常关闭。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_在_docker_容器中部署_groovy_verticle">在 Docker 容器中部署 Groovy Verticle</h3>
<div class="paragraph">
<p>同部署 JavaScript Verticle，区别在与 Verticle 代码及文件后缀名。在上述例子中，<code>hello_verticle.js</code> 在此则是 <code>hello_verticle.groovy</code> ，代码如下：</p>
</div>
<div class="listingblock">
<div class="title">hello-verticle.groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">vertx.createHttpServer().requestHandler({ request -&gt;
    request.response().end("Groovy world")
}).listen(8080)</code></pre>
</div>
</div>
<div class="paragraph">
<p>所以，在`Dockerfile`中我们只需更改verticle文件名：</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlight"><code># 继承 vert.x 镜像
FROM vertx/vertx3

# 设置要部署的 verticle 名字
ENV VERTICLE_NAME hello-verticle.groovy

# 设置 verticles 存放路径
ENV VERTICLE_HOME /usr/verticles

EXPOSE 8080

# 拷贝 verticle 至容器中
COPY $VERTICLE_NAME $VERTICLE_HOME/

# Launch the verticle
WORKDIR $VERTICLE_HOME
ENTRYPOINT ["sh", "-c"]
CMD ["exec vertx run $VERTICLE_NAME -cp $VERTICLE_HOME/*"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build and run instructions are very close to the previous ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; docker build -t sample/vertx-groovy .
....
&gt; docker run -t -i -p 8080:8080 sample/vertx-groovy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_在_docker_容器中部署_ruby_verticle">在 Docker 容器中部署 Ruby Verticle</h3>
<div class="paragraph">
<p>同部署 JavaScript Verticle，区别在与 Verticle 代码及文件后缀名。在上述例子中，<code>hello_verticle.js</code> 在此则是 <code>hello_verticle.rb</code> ，代码如下：</p>
</div>
<div class="listingblock">
<div class="title">hello-verticle.rb</div>
<div class="content">
<pre class="highlight"><code class="language-ruby" data-lang="ruby">$vertx.create_http_server().request_handler() { |request|
    request.response().end("A ruby world full of gems")
}.listen(8080)</code></pre>
</div>
</div>
<div class="paragraph">
<p>所以，在`Dockerfile`中我们只需更改verticle文件名：</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlight"><code># 继承 vert.x 镜像
FROM vertx/vertx3

# 设置要部署的 verticle 名字
ENV VERTICLE_NAME hello-verticle.rb

# 设置 verticles 存放路径
ENV VERTICLE_HOME /usr/verticles

EXPOSE 8080

# 拷贝 verticle 至容器中
COPY $VERTICLE_NAME $VERTICLE_HOME/

# Launch the verticle
WORKDIR $VERTICLE_HOME
ENTRYPOINT ["sh", "-c"]
CMD ["exec vertx run $VERTICLE_NAME -cp $VERTICLE_HOME/*"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build and run instructions are very close to the previous ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; docker build -t sample/vertx-ruby .
....
&gt; docker run -t -i -p 8080:8080 sample/vertx-ruby</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_在_docker_容器中部署_java_verticle">在 Docker 容器中部署 Java Verticle</h3>
<div class="paragraph">
<p>同样，部署 Java Verticle 与前面的例子依然差不多，区别在于将 <code>verticle jar</code> 文件复制到容器。先看 Java 代码：</p>
</div>
<div class="listingblock">
<div class="title">io.vertx.sample.hello.HelloVerticle</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package io.vertx.sample.hello;

import io.vertx.core.AbstractVerticle;

public class HelloVerticle extends AbstractVerticle {

  @Override
  public void start() throws Exception {
    vertx.createHttpServer().requestHandler(request -&gt; {
      request.response().end("Hello Java world");
    }).listen(8080);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>显而易见，本 <code>verticle</code> 被打包到 <code>target/hello-verticle-1.0.-SNAPSHOT.jar</code> 文件中。所以 <code>Dockerfile</code> 需要复制这个文件，同时也必须告知 <code>vertx</code> 需要执行的 <code>verticle</code> 类名：</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre># 继承 vert.x 镜像
FROM vertx/vertx3

#                                                       <b class="conum">(1)</b>
ENV VERTICLE_NAME io.vertx.sample.hello.HelloVerticle
ENV VERTICLE_FILE target/hello-verticle-1.0-SNAPSHOT.jar

# 设置 verticles 存放路径
ENV VERTICLE_HOME /usr/verticles

EXPOSE 8080

# 拷贝 verticle 至容器中                   <b class="conum">(2)</b>
COPY $VERTICLE_FILE $VERTICLE_HOME/

# Launch the verticle
WORKDIR $VERTICLE_HOME
ENTRYPOINT ["sh", "-c"]
CMD ["exec vertx run $VERTICLE_NAME -cp $VERTICLE_HOME/*"]</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>同前面的例子不一样，需要设置 verticle 类名及对应的文件名</p>
</li>
<li>
<p>拷贝 jar 文件至 <code>$VERTICLE_HOME</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>同理，执行命令依然没有什么变化：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; docker build -t sample/vertx-java .
....
&gt; docker run -t -i -p 8080:8080 sample/vertx-java</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置">配置</h3>
<div class="paragraph">
<p>在前面所提到的 <code>Dockerfile</code> 并没有对 Vert.x 进行相关配置。下面的几个章节，从下面几个方面着重介绍如何配置。</p>
</div>
<div class="sect3">
<h4 id="_配置_jvm_参数">配置 JVM 参数</h4>
<div class="paragraph">
<p>可以通过设置 JAVA_OPTS 环境变量来配置 Java 虚拟机，代码如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ENV JAVA_OPTS "-Dfoo=bar"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置_vertx_参数">配置 vertx 参数</h4>
<div class="paragraph">
<p>可以使用 <code>VERTX_OPTS</code> 环境变量配置 Vert.x 特定的系统变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ENV VERTX_OPTS "-Dvertx.options.eventLoopPoolSize=26 -Dvertx.options.deployment.worker=true"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_classpath">Classpath</h4>
<div class="paragraph">
<p>使用 Vert.x 命令的 <code>-cp</code> 参数或 设置 <code>CLASSPATH</code> 环境变量来配置应用程序的类路径：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ENV CLASSPATH "/usr/verticles/libs/foo.jar:/usr/verticles/libs/bar.jar:"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_日志">日志</h4>
<div class="paragraph">
<p>要配置 <code>logging.properties</code> 文件（自定义 JUL 日志记录器），请设置 <code>VERTX_JUL_CONFIG</code> 环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>COPY ./logging.properties $VERTICLE_HOME/                       <b class="conum">(1)</b>
ENV VERTX_JUL_CONFIG $VERTICLE_HOME/logging.properties          <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>拷贝 <code>logging.properties</code> 日志配置文件</p>
</li>
<li>
<p>设置 <code>VERTX_JUL_CONFIG</code> 环境变量</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_集群">集群</h4>
<div class="paragraph">
<p>可以提供自定义的 <code>cluster.xml `文件，并将其添加到类路径中。要从 `$VERTICLE_HOME</code> 中包含的所有文件构建动态类路径，可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>COPY ./cluster.xml $VERTICLE_HOME/
# ...
CMD [export CLASSPATH=`find $VERTICLE_HOME -printf '%p:' | sed 's/:$//'`; exec vertx run $VERTICLE_NAME"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意导出 <code>CLASSPATH = &#8230;&#8203;;</code> 部分在 <code>CMD</code> 指令中。它从 <code>$VERTICLE_HOME</code> 目录的内容构建 <code>CLASSPATH</code> 变量。这种技巧对于计算大型和动态类路径非常有用。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_通过_maven_构建镜像">通过 Maven 构建镜像</h3>
<div class="paragraph">
<p>在Maven构建过程中，有几个 <code>Maven`插件来构建 `Docker</code> 映像。此示例采用来自 Spotify 的
<a href="https://github.com/spotify/docker-maven-plugin">docker-maven-plugin</a> 。</p>
</div>
<div class="paragraph">
<p>首先，同往常一样创建 Java 项目。源代码位于 <code>src/main/java</code> ，然后创建一个 <code>src/main/docker</code> 目录，并在其中创建一个 <code>Dockerfile</code> ，目录结构如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>.
├── pom.xml
├── src
│   └── main
│       ├── docker
│       │   └── Dockerfile
│       └── java
│           └── io
│               └── vertx
│                   └── example
│                       └── HelloWorldVerticle.java
├── target</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在 <code>pom.xml</code> 文件增加相应的配置，代码如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;groupId&gt;com.spotify&lt;/groupId&gt;
&lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;0.2.8&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;id&gt;docker&lt;/id&gt;
    &lt;phase&gt;package&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;build&lt;/goal&gt;
    &lt;/goals&gt;
  &lt;/execution&gt;
&lt;/executions&gt;
&lt;configuration&gt;
  &lt;dockerDirectory&gt;${project.basedir}/src/main/docker&lt;/dockerDirectory&gt;
  &lt;!-- Configure the image name --&gt;
  &lt;imageName&gt;sample/vertx-hello&lt;/imageName&gt;
  &lt;resources&gt;
    &lt;resource&gt;
      &lt;targetPath&gt;/verticles&lt;/targetPath&gt;
      &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
      &lt;includes&gt;
        &lt;include&gt;${project.artifactId}-${project.version}.jar&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/resource&gt;
    &lt;!-- don't forget to also add all the dependencies required by your application --&gt;
  &lt;/resources&gt;
&lt;/configuration&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>该插件会将列出的内容复制到 <code>target/docker</code> 中。所有的资源文件 都被复制到 <code>targetPath</code> 中。所以编辑 <code>src /main/docker/Dockerfile</code> 并添加以下内容：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>FROM vertx/vertx3

ENV VERTICLE_HOME /usr/verticles
ENV VERTICLE_NAME io.vertx.example.HelloWorldVerticle

COPY ./verticles $VERTICLE_HOME

ENTRYPOINT ["sh", "-c"]
CMD ["exec vertx run $VERTICLE_NAME -cp $VERTICLE_HOME/*"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>这和上面的例子中的 <code>Dockerfile</code> 文件内容基本相同。稍微有点区别的是，插件已将文件拷贝至 <code>Dockerfile</code> 所在的目录中。</p>
</div>
<div class="paragraph">
<p>通过命令 <code>mvn clean package</code> 便可构建 Docker 镜像了。</p>
</div>
</div>
<div class="sect2">
<h3 id="_构建_fabric_8_平台使用的镜像">构建 Fabric 8 平台使用的镜像</h3>
<div class="paragraph">
<p><a href="http://fabric8.io/">Fabric 8</a> 是一个开源集成开发平台，
为基于 Kubernetes 和 OpenShift V3 的微服务提供管理、持续发布、 iPaas 设施。
可以在 Fabric 8 执行 包含 Vert.x 应用程序的 Docker 镜像。不过需要做一些额外工作，添加额外的元数据。在这个例子中，将使用 RolandHuß 的
<a href="https://github.com/rhuss/docker-maven-plugin">docker-maven-plugin</a> 。</p>
</div>
<div class="paragraph">
<p>首先来看目录结构：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>.
├── pom.xml
├── src
│   └── main
│       ├── docker
│       │   └── assembly.xml
│       └── java
│           └── io
│               └── vertx
│                   └── example
│                       └── HelloWorldVerticle.java
└── target</code></pre>
</div>
</div>
<div class="paragraph">
<p>与 Spotify 的 maven 插件不同，此插件以一个 <code>assembly.xml</code> 作为打包描述文件。该文件列出了需要复制到 docker 容器的所有文件，如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;assembly&gt;
   &lt;dependencySets&gt;
     &lt;dependencySet&gt;
       &lt;includes&gt;
         &lt;include&gt;:${project.artifactId}&lt;/include&gt;
       &lt;/includes&gt;
       &lt;outputDirectory&gt;.&lt;/outputDirectory&gt;
     &lt;/dependencySet&gt;
   &lt;/dependencySets&gt;
 &lt;/assembly&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Dockerfile在</code> 其余部分的配置在 <code>pom.xml</code> 文件中进行配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> &lt;plugin&gt;
  &lt;groupId&gt;org.jolokia&lt;/groupId&gt;
  &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.11.5&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;build&lt;/id&gt;
      &lt;phase&gt;package&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;build&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;configuration&gt;
    &lt;images&gt;
      &lt;image&gt;
        &lt;name&gt;${docker.image}&lt;/name&gt;
        &lt;build&gt;
          &lt;from&gt;vertx/vertx3&lt;/from&gt;
          &lt;tags&gt;
            &lt;tag&gt;${project.version}&lt;/tag&gt;
          &lt;/tags&gt;
          &lt;ports&gt;
            &lt;port&gt;8080&lt;/port&gt;
          &lt;/ports&gt;
          &lt;command&gt;vertx run io.vertx.example.HelloWorldVerticle -cp
            /usr/verticles/${project.artifactId}-${project.version}.jar
          &lt;/command&gt;
          &lt;assembly&gt;
            &lt;mode&gt;dir&lt;/mode&gt;
            &lt;basedir&gt;/usr/verticles&lt;/basedir&gt;
            &lt;descriptor&gt;assembly.xml&lt;/descriptor&gt;
          &lt;/assembly&gt;
        &lt;/build&gt;
      &lt;/image&gt;
    &lt;/images&gt;
  &lt;/configuration&gt;
 &lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>如需更精细地配置容器，请参考
<a href="https://github.com/rhuss/docker-maven-plugin/blob/master/doc/manual.md">手册</a> 。
<code>Dockerfile</code> 中的所有指令都可以在插件中进行设置。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
在上面的 <code>pom.xml</code> 文件使用名为 <code>docker.image</code> 的属性来设置镜像名称。不要忘记将它添加至 <code>pom.xml</code> 文件中
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>一旦有了这个配置，便需要 <a href="https://github.com/fabric8io/fabric8-maven-plugin"><code>fabric8-maven-plugin</code></a> 插件来生成 Fabric8 所需的元数据：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
&lt;groupId&gt;io.fabric8&lt;/groupId&gt;
&lt;artifactId&gt;fabric8-maven-plugin&lt;/artifactId&gt;
&lt;version&gt;2.1.4&lt;/version&gt;
&lt;executions&gt;
  &lt;execution&gt;
    &lt;id&gt;json&lt;/id&gt;
    &lt;phase&gt;generate-resources&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;json&lt;/goal&gt;
    &lt;/goals&gt;
  &lt;/execution&gt;
  &lt;execution&gt;
    &lt;id&gt;attach&lt;/id&gt;
    &lt;phase&gt;package&lt;/phase&gt;
    &lt;goals&gt;
      &lt;goal&gt;attach&lt;/goal&gt;
    &lt;/goals&gt;
  &lt;/execution&gt;
&lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦设置，就可以使用：<code>mvn clean package</code> 指令来构建 <code>docker</code> 映像。它将创建 Fabric8 所需的 <code>kubernates.json</code> 文件。
通过下面指令就可以将创建的镜像推送到由 Fabric8 提供的 Docker 注册表上。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">docker push $DOCKER_REGISTRY/sample/vertx-hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>同时不要忘记将 <code>DOCKER_REGISTRY</code> 的 URL 设置为指向由 Fabric8 管理的注册表。最后一步是应用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">mvn io.fabric8:fabric8-maven-plugin:2.1.4:apply</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_可执行镜像">可执行镜像</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>vertx/vertx3-exec</code> 镜像为其容器提供了 <code>vertx</code> 命令行功能，因此在机器上不需要安装 Vert.x ，只需要使用本 docker 镜像即可。</p>
</div>
<div class="paragraph">
<p>举个栗子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">&gt; docker run -i -t vertx/vertx3-exec -version
3.6.0-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行 verticle ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker run -i -t -p 8080:8080 \
    -v $PWD:/verticles vertx/vertx3-exec \
    run io.vertx.sample.RandomGeneratorVerticle \
    -cp /verticles/MY_VERTICLE.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command mounts the current directory (<code>PWD</code>) into <code>/verticles</code> and then launch the <code>vertx run</code> command. Notice the
<code>-cp</code> parameter reusing the <code>/verticles</code> directory.</p>
</div>
<div class="sect2">
<h3 id="_自定义技术栈">自定义技术栈</h3>
<div class="paragraph">
<p><code>vertx/vertx3-exec</code> 镜像提供默认的完整的 Vert.x 堆栈。如果需要自定义此堆栈，并创建自己的 <code>exec</code> 映像。首先，创建一个 <code>vertx-stack.json</code> 文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "variables": {
    "vertx.version": "3.3.3"
  },
  "dependencies": [
    {
      "groupId": "io.vertx",
      "artifactId": "vertx-web",
      "version": "${vertx.version}",
      "included": true
    },
    {
      "groupId": "io.vertx",
      "artifactId": "vertx-lang-js",
      "version": "${vertx.version}",
      "included": true
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在文件中列出所需的任何依赖关系，而不仅仅是 Vert.x 组件（有关详细信息，请参阅 <code><a href="../../vertx-stack-manager/stack-manager/">Stack Manager documentation</a></code> 文档）。</p>
</div>
<div class="paragraph">
<p>最后编写 <code>Dockerfile</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM vertx/vertx3-exec                                     <b class="conum">(1)</b>

COPY vertx-stack.json ${VERTX_HOME}/vertx-stack.json       <b class="conum">(2)</b>

RUN vertx resolve &amp;&amp; rm -rf ${HOME}/.m2                    <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>继承 <code>vertx/vertx3-exec</code> 镜像</p>
</li>
<li>
<p>替换 <code>vertx-stack.json</code></p>
</li>
<li>
<p>解析依赖</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>构建 Docker 镜像：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker build -t mycompany/my-vertx3-exec .</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行 Verticle ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker run -i -t -p 8080:8080 \
    -v $PWD:/verticles mycompany/my-vertx3-exec \
    run io.vertx.sample.RandomGeneratorVerticle \
    -cp /verticles/MY_VERTICLE.jar</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_部署_fat_jar">部署 fat jar</h2>
<div class="sectionbody">
<div class="paragraph">
<p>可以将一个打包成 <code>Fat jar</code> 的 Vert.x 应用程序部署到 docker 容器中。为此，不需要 Vert.x 提供的镜像，直接使用基本的 Java 镜像即可。举个栗子：</p>
</div>
<div class="paragraph">
<p>First, be sure your application is packaged as a <em>fat jar</em>. Then, use the following <code>Dockerfile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>FROM openjdk:8-jre-alpine                                           <b class="conum">(1)</b>

ENV VERTICLE_FILE hello-verticle-fatjar-3.0.0-SNAPSHOT-fat.jar      <b class="conum">(2)</b>

# 设置 verticles 存放路径
ENV VERTICLE_HOME /usr/verticles

EXPOSE 8080

# Copy your fat jar to the container
COPY target/$VERTICLE_FILE $VERTICLE_HOME/                          <b class="conum">(3)</b>

# Launch the verticle
WORKDIR $VERTICLE_HOME
ENTRYPOINT ["sh", "-c"]
CMD ["exec java -jar $VERTICLE_FILE"]                               <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>扩展 OpenJDK 8 镜像</p>
</li>
<li>
<p>将 <code>VERTICLE_FILE</code> 设置为指向 <strong>fat jar</strong></p>
</li>
<li>
<p>从 target 目录中复制 <strong>fat jar</strong> 。如果不使用 Maven ，请根据实际情况修改</p>
</li>
<li>
<p>使用 <code>java</code> 指令启动应用程序</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>它基本上是与以前的 <code>Dockerfile</code> 类似。区别在于，这次我们扩展的是 <code>java:8</code> 而不是 <code>vertx/vertx3</code> 镜像。 然后我们将 <strong>fat jar</strong> 复制到容器中，并使用 <code>java</code> 指令来启动。当然，上述所有配置设置仍然有效的。</p>
</div>
<div class="paragraph">
<p>最后构建并启动容器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&gt; docker build -t sample/vertx-java-fat .
....
&gt; docker run -t -i -p 8080:8080 sample/vertx-java-fat</code></pre>
</div>
</div>
</div>
</div>
        

        
          <div id="footer">
            <div id="footer-text">
              
                上次更新时间 2018-11-05 19:55:34 CST
              
              
            </div>
          </div>
        
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse Vert.x</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/">主页</a></li>
          <li><a href="https://vertx.tk/download/">下载</a></li>
          <li><a href="https://vertx.tk/docs/">文档</a></li>
          <li><a href="https://github.com/vert-x3/wiki/wiki">维基</a></li>
          <li><a href="https://vertx.tk/blog/">博客</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Community</h2>
        <ul class="list-unstyled">
          <li><a href="https://vertx.tk/community/">Help &amp; Contributors</a></li>
          <li><a href="https://vertx.tk/materials/">Learning materials</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx">User Group</a></li>
          <li><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx-dev">Developer Group</a></li>
          <li><a href="//shang.qq.com/wpa/qunwpa?idkey=587f58cacb9557e3291b46098e0fe09427b98a1c0f866da23c04c2762bc7e2ad">QQ群</a></li>
        </ul>
      </div>
      <div class="col-xs-4 col-sm-4 col-md-2 col-lg-2">
        <h2>Eclipse</h2>
        <ul class="list-unstyled">
          <li><a href="http://www.eclipse.org/">Eclipse Foundation</a></li>
          <li><a href="https://eclipse.org/legal/privacy.php">Privacy Policy</a></li>
          <li><a href="https://eclipse.org/legal/termsofuse.php">Terms of Use</a></li>
          <li><a href="https://eclipse.org/legal/copyright.php">Copyright Agent</a></li>
          <li><a href="http://www.eclipse.org/legal">Legal Resources</a></li>
        </ul>
      </div>

      <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 copyright">
        <p>Eclipse Vert.x is open source and dual-licensed under the <a href="http://www.eclipse.org/legal/epl-v20.html">Eclipse Public License 2.0</a> and <a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
        <p>This website is licensed under the <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 License</a>.<br>
        Design by <a href="https://www.michel-kraemer.com">Michel Kr&auml;mer</a>.</p>
        <div class="row">
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-2">
            <a href="http://eclipse.org">
            <img class="logo eclipse-logo" src="https://vertx.tk/assets/eclipse_logo_grey_small.png" width="204" height="48">
            </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-1 col-lg-offset-0">
            <a href="http://cloudbees.com">
            <img class="logo cloudbees-logo" src="https://vertx.tk/assets/Button-Built-on-CB-1-grey.png" width="180" height="48">
           </a>
          </div>
          <div class="col-sm-12 col-md-5 col-md-offset-7 jprofiler">
            <a href="http://www.ej-technologies.com/products/jprofiler/overview.html"
            style="text-decoration:none">
            <img class="logo jprofiler-logo" src="https://vertx.tk/assets/jprofiler-logo.png" width="48" height="48"><span class="jprofiler-logo">&nbsp; JPROFILER</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://vertx.tk/javascripts/bootstrap.min.js"></script>
<script src="https://vertx.tk/javascripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



<script src="https://vertx.tk/javascripts/sidebar.js"></script>


<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#64386b",
      "text": "#ffcdfd"
    },
    "button": {
      "background": "transparent",
      "text": "#f8a8ff",
      "border": "#f8a8ff"
    }
  },
  "content": {
    "message": "This website uses anonymous cookies to ensure we provide you the best experience. ",
    "link": "Opt out!",
    "href": "https://tools.google.com/dlpage/gaoptout/"
  }
})});
</script>
</body>
</html>

